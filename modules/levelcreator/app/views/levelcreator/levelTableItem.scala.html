@(level: models.knowledge.Level, stacksInQueue: Option[Int], stacksInProgress: Option[Int])
@import brainflight.view.helpers._

@calculateProgress(n: Long, p: Int, q: Int) = @{ 
    val d = (n + p + q).toFloat
    if(d == 0) 100 -> 0
    else n*100 / d -> p*100 / d
}

@progressBar(n: Long)  = {
    @defining(calculateProgress(n, stacksInProgress.getOrElse(0), stacksInQueue.getOrElse(0))){ progress =>
      <div class="progress progress-striped">
        <div class="bar bar-success" style="width: @progress._1%;"></div>
        <div class="bar bar-warning" style="width: @progress._2%;"></div>
      </div>
    }
}

<tr data-levelid="@level.id">
  <td> 
    <a href="#" data-prompt="@level.id" title="@level.id">#</a>
    <a href="@controllers.levelcreator.routes.StackController.list(level.id)">@level.name</a>
  </td>
  <td> @level.width x @level.height x (@level.slidesBeforeProblem + @level.slidesAfterProblem) </td>
  <td> @level.dataSetName </td>
  <td class="status-cell"> 
    @defining(level.numberOfRenderedStacks){ n =>
      @progressBar(n)
      <span title="Finished">
        <i class="icon-ok"></i>
        @n
      </span>
      <span title="in Progress">
        <i class="icon-retweet"></i>
        @stacksInProgress.getOrElse(0)
      </span>
      <span title="in Queue">
        <i class="icon-inbox"></i>
        @stacksInQueue.getOrElse(0)
      </span>
    }
  </td>
  <td>  
    <a href="@controllers.levelcreator.routes.LevelCreator.use(level.id)"><i class="icon-pencil"></i> edit</a><br />
    <a href="@controllers.levelcreator.routes.StackController.produce(level.id)" class="produce-stacks">
      <i class="icon-retweet"></i> 
      produce Stacks
    </a><br />
    <input type="checkbox" @if(level.autoRender) { @Html("checked") } class="auto-render-stacks"> auto render
    <br />
    <a href="@controllers.levelcreator.routes.StackController.list(level.id)" class="view-stacks">
      <i class="icon-picture"></i> view Stacks
    </a><br />
    <a href="@controllers.levelcreator.routes.LevelCreator.delete(level.id)" data-ajax="method=DELETE,delete-row,confirm"><i class="icon-trash"></i> delete </a>
  </td>
</tr>