@(user: models.user.User, tracing: models.tracing.Tracing)

@reviewLink() = {
  <a href=@controllers.admin.routes.TrainingsTracingAdministration.startReview(tracing.id) data-ajax="replace-row"><i class="icon-eye-open"></i> start review </a>  
}

@oxalisLink() = {
  <a href="@controllers.admin.routes.TrainingsTracingAdministration.oxalisReview(tracing.id)"><i class="icon-random"></i> view in oxalis </a><br />
}

@nmlDownloadLink() = {
  <a href="@controllers.admin.routes.NMLIO.download(tracing.id)"><i class="icon-download"></i> download NML </a><br />
}

@finishReviewLink() = {
  <a href="@controllers.admin.routes.TrainingsTracingAdministration.finishReview(tracing.id)"><i class="icon-ok-sign"></i> finish review </a><br />
}

@abortReviewLink() = {
  <a href="@controllers.admin.routes.TrainingsTracingAdministration.abortReview(tracing.id)" data-ajax="replace-row,confirm"><i class="icon-remove-sign"></i> abort review </a>
}

@finishedLabel(reviews: List[models.tracing.TracingReview]) = {
  <i class="icon-ok"></i><span> finished @reviews.headOption.flatMap(_.reviewee).map{user => 
    (reviewed by @user.name)
  }</span>
}

@alreadyInReviewLabel(review: models.tracing.TracingReview) = {
  <i class="icon-eye-open"></i><span> Already getting reviewed by @review.reviewee.map( _.name).</span>
}

@import brainflight.format._

<tr>
  <td> @tracing.user.map(_.name).getOrElse("<Maik>") </td>
  <td> @formatDate(tracing.date) </td>
  <td>
  @{tracing.review match{
    case r if tracing.state.isFinished =>
      finishedLabel(r)
    case _ if tracing.state.isInProgress =>
      <i class="icon-time"></i><span> User is working on the task</span>
    case r :: _ if r._reviewee == user._id && tracing.state.isInReview =>
      oxalisLink() + nmlDownloadLink() + finishReviewLink() + abortReviewLink
    case r :: _ if r._reviewee != user._id && tracing.state.isInReview =>
      alreadyInReviewLabel(r)
    case _ if tracing.state.isReadyForReview =>
      reviewLink()
    case _ =>
      "Invalid state."
  }}
</tr>